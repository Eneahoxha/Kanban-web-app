<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kanban WebApp</title>
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"/>
  <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.2/dist/full.min.css" rel="stylesheet" type="text/css" />
  <script src="https://cdn.jsdelivr.net/npm/tailwindcss@3.4.4/dist/tailwind.min.js"></script>
  
  <script>
    tailwind.config = {
      darkMode: 'class', 
      daisyui: {
        themes: ["light", "dark", "cupcake"], 
      },
    }
  </script>
  
  <link rel="stylesheet" href="src/style.css" />
  <script src="main.js" defer></script>
</head>
<body data-theme="light">

  <!-- ORA GLOBALE -->
  <div id="global-clock-container">
      <span id="global-clock" class="flex items-center gap-2">
          <i class="bi bi-clock-fill"></i>
          <span id="global-clock-time">Caricamento ora...</span>
      </span>
  </div>

  <!-- HEADER CON DARK MODE TOGGLE -->
  <div class="container relative">
    <h1 class="heading-center">Kanban Board</h1>
    <button id="dark-mode-toggle" class="btn btn-circle btn-outline absolute top-4 right-4 z-50" title="Dark Mode">
      <i class="bi bi-moon-fill"></i>
    </button>
  </div>

  <!-- COLONNE -->
  <div class="container columns">
  </div>

  <!-- MODALE CONFERMA ELIMINAZIONE -->
  <dialog id="confirm-modal-id" class="modal">
    <div class="modal-box">
      <form method="dialog">
        <h3 class="font-bold text-lg text-error">
          <i class="bi bi-trash-fill mr-2"></i> Cancellare Task?
        </h3>
        <p class="py-4">Sei sicuro di voler cancellare la task: </p>
        <div class="preview font-mono text-sm mb-4"></div>
        <div class="modal-action">
          <button type="submit" formmethod="dialog" value="cancel" class="btn btn-ghost" id="cancel">Annulla</button>
          <button type="submit" class="btn btn-error" id="confirm">Sì, eliminala</button>
        </div>
      </form>
    </div>
  </dialog>

  <!-- MODALE NUOVA CATEGORIA -->
  <dialog id="category-modal-id" class="modal">
    <div class="modal-box">
      <form method="dialog">
        <h3 class="font-bold text-lg text-info">
          <i class="bi bi-list-columns-reverse mr-2"></i> Nuova Categoria
        </h3>
        <p class="py-4">Inserisci il nome per la nuova colonna:</p>
        <input type="text" id="category-name-input" class="input input-bordered w-full mb-4" placeholder="Nome categoria" required />
        <div class="modal-action">
          <button type="button" class="btn btn-ghost" id="category-cancel">Annulla</button>
          <button type="submit" class="btn btn-info" id="category-confirm">Aggiungi</button>
        </div>
      </form>
    </div>
  </dialog>

  <!-- MODALE CREA TASK -->
  <dialog id="create-task-modal" class="modal">
    <div class="modal-box">
      <h3 class="font-bold text-lg text-info">
        <i class="bi bi-plus-circle-fill mr-2"></i> Crea Nuova Task
      </h3>
      <p class="py-4">Inserisci i dettagli per la nuova task:</p>

      <form id="create-task-form" class="space-y-4">
        <div class="form-control">
          <label class="label">
            <span class="label-text">Titolo Task (Obbligatorio)</span>
          </label>
          <input id="task-title" type="text" placeholder="Es: Correggere bug login" class="input input-bordered w-full" required />
        </div>

        <div class="form-control">
          <label class="label">
            <span class="label-text">Priorità</span>
          </label>
          <select id="task-priority" class="select select-bordered w-full">
            <option value="Bassa" selected>Bassa (Verde)</option>
            <option value="Media">Media (Giallo)</option>
            <option value="Alta">Alta (Rosso)</option>
          </select>
        </div>

        <div class="form-control">
          <label class="label">
            <span class="label-text">Data e Ora di Scadenza (Obbligatorio)</span>
          </label>
          <input id="task-due-date" type="datetime-local" class="input input-bordered w-full" required />
          <label class="label">
            <span class="label-text-alt">Formato: Anno-Mese-Giorno T Ora:Minuti (es: 2025-12-31T23:59)</span>
          </label>
        </div>

        <div class="modal-action">
          <button type="button" id="create-cancel" class="btn btn-ghost">Annulla</button>
          <button type="submit" class="btn btn-info">Crea Task</button>
        </div>
      </form>
    </div>
  </dialog>

  <!-- FAB -->
  <div class="fab">
    <div tabindex="0" id="Aggiungi" role="button" class="btn btn-lg btn-circle btn-info">
      <i class="bi bi-plus-lg"></i>
    </div>

    <div class="fab-actions">
      <div data-tooltip="Nuova Categoria" class="tooltip tooltip-left">
        <button data-add="NuovaCategoria" id="NuovaCategoria" class="btn btn-lg btn-circle btn-info">
          <i class="bi bi-list-columns"></i>
        </button>
      </div>
      <div data-tooltip="Nuova Task" class="tooltip tooltip-left">
        <button data-add="NuovaTask" class="btn btn-lg btn-circle btn-success">
          <i class="bi bi-card-checklist"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- SCRIPT DARK MODE, CLOCK E VALIDAZIONE -->
  <script>
    // Dark mode toggle
   const toggle = document.getElementById('dark-mode-toggle');
const body = document.body;
toggle.addEventListener('click', () => {
  if(body.getAttribute('data-theme') === 'light'){
    body.setAttribute('data-theme', 'dark');
    toggle.innerHTML = '<i class="bi bi-sun-fill"></i>';
  } else {
    body.setAttribute('data-theme', 'light');
    toggle.innerHTML = '<i class="bi bi-moon-fill"></i>';
  }
});

    // Orologio globale
    function updateClock() {
      const now = new Date();
      const hours = String(now.getHours()).padStart(2,'0');
      const minutes = String(now.getMinutes()).padStart(2,'0');
      const seconds = String(now.getSeconds()).padStart(2,'0');
      document.getElementById('global-clock-time').textContent = `${hours}:${minutes}:${seconds}`;
    }
    setInterval(updateClock, 1000);
    updateClock();

    // Validazione data obbligatoria con messaggio personalizzato
    const taskForm = document.getElementById('create-task-form');
    const dueDateInput = document.getElementById('task-due-date');

    dueDateInput.addEventListener('input', () => {
      dueDateInput.setCustomValidity('');
    });

    taskForm.addEventListener('submit', (e) => {
      if (!dueDateInput.value) {
        dueDateInput.setCustomValidity('La data di scadenza è obbligatoria');
        dueDateInput.reportValidity();
        e.preventDefault();
      }
    });
  </script>
</body>
</html>
